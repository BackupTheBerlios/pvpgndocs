<style type="text/css">
<!--
.style1 {font-size: x-small}
.style3 {font-size: xx-small; font-family: "Courier New", Courier, mono; }
.style4 {font-size: x-small; font-style: italic; }
.style6 {font-size: x-small; font-weight: bold; }
-->
</style>
<center>
    <h2><a name="top">NAT / Firewall or TCP/IP Addressing </a></h2>
    <p>By dgwilson65 and U-238</p>
</center>
<p><b><a name="contents">Table of contents</a></b></p> 
  <blockquote>
    <div style="background-color: #DDDDDD; color: #000000; padding: 4px;">
      <ul>
        <li><a href="#intro">Introduction</a></li>
        <li><a href="#ports"> What ports does PvPGN use?</a></li>
        <li><a href="#portforwarding"> Setting up port forwarding</a></li>
        <li><a href="#translation"> Setting up address_translation (formerly gametrans</a>)</li>
        <li><a href="#Starctaftlag">Starcraft and LAG</a></li>
        <li><a href="#w3route">Configuring PvPGN for WarCraft III </a></li>
        <li><a href="#diablorouter"> Setting up a Diablo II closed realm from behind a router </a></li>
        <li><a href="#firewallissues"> Diagnosing Router/Firewall issues</a></li>
      </ul>
    </div>
  </blockquote>
<p><b><a name="intro">Introduction</a></b></p>
<blockquote>
  <p>  This section takes a look at the TCP/IP ports used by PvPGN and the clients
  that access it. How to get internet users and local LAN users playing on the
  same PvPGN server, and what special configuration you need to have applied to PvPGN and
  your router/firewall.</p>
  <p>This is an adventure in TCP/IP administration. Sorry I didn't mean it
    to sound scary it can be scary only if you let it. Think of this subject as 
    plumbing, keep a cool head and you should be OK. Remember that for each
    TCP/IP address on the internet it can open up to 65535 ports from that
    address to establish a connection to another server or client. Each port
    has a number. Some of the numbers are reserved for special things and given
    names, e-mail, ftp, http (web - port 80). If you're not with the program by
    now then perhaps its time to skip this section.</p>
  <p>On to things PvPGN related. Consider the following three server scenarios:</p>
  <table width="554" border="0">
    <tr>
      <td width="153">Server Outside </td>
      <td width="391">One client inside LAN (with server) </td>
    </tr>
    <tr>
      <td>&nbsp;</td>
      <td>Two or more clients inside LAN (with server) with or without external players (having external players in this scenario can introduce the famous StarCraft LAG problem </td>
    </tr>
    <tr>
      <td>Server on the Router </td>
      <td>One client inside LAN (with server) </td>
    </tr>
    <tr>
      <td>&nbsp;</td>
      <td>Two or more clients inside LAN (with server) with or without external players (having external players in this scenario can introduce the famous StarCraft LAG problem </td>
    </tr>
    <tr>
      <td>Server inside the LAN </td>
      <td>One client inside LAN (with server) </td>
    </tr>
    <tr>
      <td>&nbsp;</td>
      <td>Two or more clients inside LAN (with server) with or without external players (having external players in this scenario can introduce the famous StarCraft LAG problem </td>
    </tr>
    <tr>
      <td>&nbsp;</td>
      <td>Adding a more complicated scenario where you might have LAN clients in another network then the server but still behind the same router. </td>
    </tr>
    <tr>
      <td>&nbsp;</td>
      <td>And yet more complicated but fundamentally the same scenario as just above where some &quot;LAN&quot; client on another network are actually across a VPN (Virtual Private Network) </td>
    </tr>
  </table>
  <p>Examining the Clients they fit into three classes. They have been grouped like this because they have different networking configuration needs.</p>
  <table width="424" border="0">
    <tr>
      <td width="64" valign="top">Class 1 </td>
      <td width="126">Diablo I*,<br> 
      StarCraft, BroodWar, WarCraft 2 BattleNet Edition </td>
    </tr>
    <tr>
      <td valign="top">Class 2 </td>
      <td>Diablo II </td>
    </tr>
    <tr>
      <td valign="top">Class 3 </td>
      <td><p>WarCraft III, <br>
        WarCraft III - The Frozen Throne </p>
      </td>
    </tr>
  </table>
  <p>* Diablo 1 - might be a special class all on it's one. We're actually unsure if it uses port 6112 UDP for game traffic. It possibly uses some TCP port instead. </p>
  <p>What's the message here? Well, think about whay you are trying to achieve and why. The set up requirements of the many different scenarios differ and to get them all running will take some careful thought and planning. Our recommendation is to set up one piece, test it, verify everything works, before adding to your configuration. This recommendation applies to both PvPGN and your Firewall/router. </p>
  <p>If something doesn't work make sure that you are logging for &quot;TRACE and DEBUG&quot; in your bnetd.conf file. Try to resolve issue first by examining the bnetd.log file and your firewall/router logs. Then and only if you have tried to fix things yourself post a message to the forums or log onto IRC. Make sure you have details about PvPGN versions, log file details, conf file details etc. </p>
  <p>As always suggested changes or enhancements to the documentation for the continual cycle of improvement are welcome. We look forward to your feedback and contributoins (even better when you've written them!). </p>
</blockquote>
<p><br>
  <strong>What ports does PvPGN use?<a name="ports"></a></strong></p>
<blockquote>
    <p> In order to connect to your PvPGN server, you will need to open at least one 
    if not multiple ports. What ports you open really depend on what games you want
    to support/connect to your server. Port 6112 must be open for both the TCP &amp; UDP 
    protocols. Their are no exceptions here...6112 must be open period to connect to PvPGN.<br>
    <br>
  Here's a break down of what ports go to each program on the server side:</p>
    <pre>     Port Protocol   Program Name    Program Description
       23   TCP      bnetd           Telnet Connection Support
     4000   TCP      d2gs            Diablo II Closed Game Server
     6112   TCP/UDP  bnetd           Basic Battle.net (TM) Chat &amp; Game Initialization
     6113   TCP      d2cs/d2closed   Diablo II Realm Server
     6114   TCP      d2dbs/d2closed  Diablo II Database Server
     6114   UDP      bntrackd        Tracking Daemon for Producing Stats
     6200   TCP      bnetd           Warcraft III Router
     6667   TCP      bnetd           IRC Connection Support</pre>
    <p> Here is a break down of what games uses what port on the client side:</p>
    <pre>     Game Name                               Port Number(s)
     Warcraft II Battle.net (TM) Edition (BNE)  6112
     Warcraft III Reign of Chaos                6112, 6200
     Starcraft                                  6112
     Starcraft Brood War                        6112
     Diablo                                     6112
     Diablo II Open Battle.net (TM)             6112
     Diablo II Closed Battle.net (TM)           6112, 4000</pre>
    <p>For people to be able to access your server from the internet you will need to configure your firewall/router to allow these ports to send traffic (UDP and TCP) to the PvPGN server on your LAN.</p>
</blockquote>
<p><br>
  <strong>Setting up port forwarding<a name="portforwarding"></a></strong></p>
<blockquote>
    <p> If all your users are only ever going to access your PvPGN server from the 
    local LAN then you don't need to worry about this.<br>
    <br>
    If you have users on the Internet that will be accessing your PvPGN server 
    then you are going to more than likely have a firewall amnd/or router as part of your setup.<br>
    <br>
    You will require administration rights to your firewall/router. If you
    don't have these then either get the access required or understand what
    you need from this documentation so that you can request that the 
    administrator make the appropriate changes for you.<br>
    <br>
    Due to the vast numbers of firewalls and routers available it is not possible
    to provide instructions on configuring your specific device for port
    forwarding rules. However for home sized installations you would more
    than likely access your firewall/router via a web page and add or
    modify existing entries to achieve the desired setup. An example of some
  port forwarding entries is listed below</p>
    <pre>      
       Proto     External source IP     Source port     Destination IP      Destination port
       TCP             ALL                  6112        192.168.10.198            N/A
       UDP             ALL                  6112        192.168.10.198            N/A
       TCP             ALL                  6113        192.168.10.198            N/A
       UDP             ALL                  6113        192.168.10.198            N/A
       TCP             ALL                  6114        192.168.10.198            N/A
       UDP             ALL                  6114        192.168.10.198            N/A
       TCP             ALL                  4000        192.168.10.198            N/A
       UDP             ALL                  4000        192.168.10.198            N/A
       
       TCP             ALL                 16100        192.168.10.100           6112
       UDP             ALL                 16100        192.168.10.100           6112</pre>
    <p> Final note. Do you need a free firewall/router? Do you have a spare older
    model PC with at least a 600MB hard drive, 32MB-64MB of RAM and maybe
    slightly better than 100MHz processor?
    Take a look at <a href="http://www.smoothwall.org">http://www.smoothwall.org</a> you'll end up downloading a free
    ~35MB CD image that will be installed onto the &quot;donor&quot; PC. Install 2
    Network Interface Cards in the PC and you're away.<br>
  </p>
</blockquote>
<p><strong>Setting up address_translation (formerly gametrans)<a name="translation"></a></strong></p>
<blockquote>
    <p> The configuration file address_translation.conf can be found in the conf
      directory. Previously known as gametrans.conf, w3trans.conf, realm.conf, and 
      d2gstrans.conf PvPGN 1.7 now combines all these files into a single file.<br>
      <br>
      The address_translation configuration file provides a mechanism for external
      users to communicate with game playing users on the same LAN as the PvPGN 
      server. Thus you map all of your internal ip addresses to your external ip 
      address on different TCP/IP ports giving an illusion of appearing externally.
      The address_translation file is important in that it can be used to solve 
      NAT/Firewall issues in conjunction with Port Forwarding and or LooseUDP methods.<br>
      <br>
      Warning: This provides address translation for PvPGN. You must also configure
      your firewall/router to match this port mapping and do the required<br>
  translation.</p>
    <p> To put it simply it is all plumbing. When you first meet on the server, the
      server handles the communication. When the game starts communication <br>
      responsibility is passed to the game or each machine.<br>
      <br>
      Lets look at an example...<br>
      Internal LAN 192.168.10.100 - game player a<br>
      192.168.10.101 - game player b<br>
      192.168.10.102 - game player c<br>
      192.168.10.198 - PvPGN Server<br>
      201.201.20.201 - external IP address<br>
      <br>
      VPN LAN 192.168.20.150 - game player d<br>
  202.202.20.202 - external IP address</p>
    <p> Internet 123.123.12.123 - game player e</p>
    <p> We want game players a,b,c,d,e all to be aple to play on the PvPGN server 
      at 201.201.20.201. This means Internet user requires some direct visibility
  of game players a,b,c,d and you need to provide that. </p>
    <p> The address_translation.conf entries to support the above example would look
  like the table below to support StarCraft gameplay.</p>
    <pre>192.168.10.100:6112      201.201.20.201:16100      192.168.10.0/24,192.168.20.0/24      ANY
192.168.10.101:6112      201.201.20.201:16101      192.168.10.0/24,192.168.20.0/24      ANY
192.168.10.102:6112      201.201.20.201:16102      192.168.10.0/24,192.168.20.0/24      ANY
192.168.20.150:6112      202.202.20.202:16150      192.168.10.0/24,192.168.20.0/24      ANY</pre>
    <p> To describe the first entry in tis table, game player a on 192.168.10.100 and
      port 6112 (Starcraft) is externally mapped to 202.201.20.201 and port 16100.
      Notice how ip address *.*.*.100 is mapped to port 16100. This is just a convention
      that has been used for tracking entries at the firewall/router and what they mean.
      Any other players on the network 192.168.10.0/24 are excluded from this translation
      as are any players on 192.168.20.0/24 across the VPN.<br>
      <br>
      To support the address_translation.conf you also need to make the entries in your
      firewall/router. Again using the example above you need to setup a rule that:
      Forwards TCP port 16100 as port 6112 to IP address 192.168.10.100 and
      Forwards UDP port 16100 as port 6112 to IP address 192.168.10.100
  Make similar entries for everyone on the same LAN as the PvPGN server.</p>
    <p> For the VPN user, they must also make a simiar entry in their firewall/router.
      Making sure that both the TCP and UDP traffic is routed.<br>
      <br>
      After making changes to the address_translation.conf file you will need to
      restart the PvPGN server for the changes to be effective.<br>
      <br>
      Below is the address_translation.conf file as supplied with the 1.7 release.
      Notice that it is split into 4 sections:<br>
      w3route server ip (removed from w3trans.conf) (Port 6200)<br>
      Game Translations for clients (removed from gametrans.conf) (client data ports)<br>
      Diablo II Charactar Server (d2cs) - (removed from realm.conf) (Port 6113)<br>
  Diablo II Game Server (d2gs) - (removed from d2gstrans.conf) (Port 4000)</p>
    <p> Make sure you read the comments within the file as they contain more detailed
      information on the setup. They may also be more accurate than the documentation.<br>
      <br>
      <em>&lt;Editors note: Documentation requires expansion for Diablo II &gt; </em></p>
</blockquote>
<pre>    ########################################################################################################
    #------------------------------------------------------------------------------------------------------#
    # Address Translation table #
    #------------------------------------------------------------------------------------------------------#
    # #
    # This is a list of ip:port addresses that get translated #
    # #
    # The entries are broken into four parts: #
    # #
    # * the IP address w/port to be translated #
    # * the output IP address w/port #
    # * comma delimited list of networks to be excluded from translation #
    # * comma delimited list of networks to be included in translation #
    # #
    # Each line must contain all four parts or the entire entry will be rejected #
    # There are no default ports, make sure input and output includes the port number #
    # #
    # The entries are searched in the order listed in this file #
    # Exclude networks are searched before include networks #
    # Only the first matching line is used #
    # Lines begining with '#' are ignored #
    # #
    # If no match is found, the input ip will be returned. #
    # #
    # NONE = There are no neworks to exclude/include (just a place holder, no entries will be added) #
    # ANY = All networks will be excluded/included (same as 0.0.0.0/0) #
    # #
    ########################################################################################################</pre>
<pre>    ########################################################################################################
    # w3route server ip (removed from w3trans.conf) (Port 6200) #
    # #
    # Set input address the same as the w3routeaddr setting in the bnetd.conf #
    # Set output address to the address to be sent to war3 clients #
    # Set exclude to the range of clients you want to recieve the input address #
    # instead of the output address #
    # Set include to the range of clients you want to recieve the output address #
    # #
    # input (ip:port) output (ip:port) exclude (ip/netmask) include (ip/netmask) #
    #--------------------- ---------------------- ---------------------------- -------------------------#
    #0.0.0.0:6200 192.168.1.100:6200 NONE 192.168.1.0/24
    0.0.0.0:6200 internetip:6200 NONE ANY</pre>
<pre>    ########################################################################################################
    # Game Translations for clients (removed from gametrans.conf) (client data ports) #
    # #
    # Set input address to the client to be translated #
    # Set output address to the address to be sent to the other clients #
    # Set exclude to the range of clients you want to recieve the input address #
    # instead of the output address #
    # Set include to the range of clients you want to recieve the output address #
    # #
    # input (ip:port) output (ip:port) exclude (ip/netmask) include (ip/netmask) #
    #--------------------- ---------------------- ---------------------------- -------------------------#</pre>
<pre>    #192.168.1.1:6119 internetip:6119 192.168.1.0/24,10.0.0.0/8 ANY
    #192.168.1.2:6118 internetip:6118 192.168.1.0/24 ANY</pre>
<pre>    ########################################################################################################
    # Diablo II Charactar Server (d2cs) - (removed from realm.conf) (Port 6113) #
    # #
    # Set input address to the ip of d2cs (same as the ip in the realm.conf) #
    # Set output address to the address to be sent to the clients #
    # Set exclude to the range of clients you want to recieve the input address #
    # instead of the output address #
    # Set include to the range of client you want to recieve the output address #
    # #
    # input (ip:port) output (ip:port) exclude (ip/netmask) include (ip/netmask) #
    #--------------------- ---------------------- ---------------------------- -------------------------#
    #192.168.1.100:6113 internetip:6113 192.168.1.0/24 ANY</pre>
<pre>    ########################################################################################################
    # Diablo II Game Server (d2gs) - (removed from d2gstrans.conf) (Port 4000) #
    # #
    # Set input address to the ip of d2gs (same as the gameservlist in d2cs.conf) #
    # Set output address to the address to be sent to the clients #
    # Set exclude to the range of clients you want to recieve the input address #
    # instead of the output address #
    # Set include to the range of client you want to recieve the output address #
    # #
    # input (ip:port) output (ip:port) exclude (ip/netmask) include (ip/netmask) #
    #--------------------- ---------------------- ---------------------------- -------------------------#
    #192.168.1.100:4000 internetip:4000 192.168.1.0/24 ANY</pre>
<blockquote>
  <p>The Gametrans file is always read in order and will stop at the first matching rule. So if you want two different rules for the same client, you will need     
        to make sure that each rule is unique. </p>
</blockquote>
<p><strong> StarCraft and LAG<a name="Starctaftlag"></a></strong></p>
<blockquote>
  <p>There is a situation where StarCraft can become unplayable. It requires a set up with a Local Area Network within which the PvPGN server exists and more than one player within that LAN. Additionally it requires an internet connection with one or more players - the external network or WAN. There are a couple more things to understand:</p>
  <p>The starcraft game is played by the client computers, the server has nothing to do with the actual running of the game. Thus if an event occurs on the external network and one of the client computers needs to send a message to all of the other players, he needs direct access to the client computers on the LAN as well. This is probably best described as a peer-to-peer game. When there is no connection between clients, the game is looping, changing the "game creator/owner" from WAN to LAN client, so that' why it looks like a LAG</p>
  <p>The PvPGN forums has had many discussions on this subject over time <a href="http://forums.pvpgn.org">http://forums.pvpgn.org.</a>. Forums participants and the PvPGN developers indicate that this is not a bug in StarCraft. It's probably more related to the age of the product. If you're reading this, you are most likely interested in how to work around this challenge. </p>
  <p>What do I have to do?</p>
  <p>You need complete control of your environment, PvPGN server, Client computers, StarCraft configuration, and your Firewall. You must have control or be able to influence the set up on these components before you proceed.</p>
  <p>What you are trying to do is provide direct communications paths between all game players and the TCP/IP port level. Here's the solution.</p>
  <ol>
    <li>Open ports 6112-6119 on your firewall - these should be forwarded to your server</li>
    <li>Identify the IP addresses of your StarCraft players on your internal LAN (if you are using DHCP, you might need to enforce some allocation by MAC address so that you retain some control) </li>
    <li>Select a range of ports for your players, 18101 through to 18112 for example. It's usually easier if you tie the last three digits of the port numbers to the last 3 digits of the IP address. </li>
    <li>Port forwarding rules need to be established on your firewall for these ports and IP addresses</li>
    <li>Each StartCraft player on the LAN must have a Windows Registry setting (or equivallent on Mac) that declares the Game Data Port.</li>
    <li>Finally configure PvPGN and the address_translation.conf file</li>
  </ol>
  <p>If you've managed to get this far, are still keen to proceed, and understand what we've covered so far, then lets get into it. </p>
  <p>The following shell script makes the changes we require to the firewall. Your firewall may allow you to make these changes, or you will need some manual way to effect the change. Basically it associates the IP address and port numbers on LAN. </p>
  <pre># by TRex
# IPTABLES path
# The number below depends on your system configuration
#IPT=`whereis iptables | awk ' {print &Acirc;&nbsp;$2}'`
IPT=&quot;iptables&quot;
echo &quot;script underway...&quot;</pre>
  <pre>#---------------------------------------
PORT=&quot;16185&quot;
EXT_IP=&quot;245.012.10.1&quot;
BATTLE_HOST=&quot;192.168.10.185 192.168.10.186 192.168.10.187 192.168.10.188 192.168.10.189 
192.168.10.190 192.168.10.191 192.168.10.192 192.168.10.193 192.168.10.194 192.168.10.195 
192.168.10.196 192.168.10.197 192.168.10.98 192.168.10.199 192.168.10.200&quot; 
#---------------------------------------</pre>
  <pre>usage()
   {
   echo &quot;Usage: $0 {start|stop}&quot;
   }
   case &quot;$1&quot; in</pre>
  <pre>start)</pre>
  <pre>echo &quot;received START&quot;
     PORT_II=$PORT</pre>
  <pre>for HOST in $BATTLE_HOST; do
   PORT_I=$PORT_II
   $IPT -t nat -A PREROUTING -p udp -d $EXT_IP --dport $PORT_II -j DNAT --to-destination $HOST:$PORT_II
   $IPT -t nat -A POSTROUTING -p udp -s $HOST --sport $PORT_II -j SNAT --to-source $EXT_IP:$PORT_II
   PORT_II=$[PORT_I + 1]
   done</pre>
  <pre>$IPT -L -v -t nat |grep &quot;udp spt:16&quot;
     $IPT -L -v -t nat |grep &quot;udp dpt:16&quot;</pre>
  <pre>echo &quot;Battle - START - OK&quot;
     ;;</pre>
  <pre>stop)</pre>
  <pre>PORT_II=$PORT</pre>
  <pre>for HOST in $BATTLE_HOST; do
   PORT_I=$PORT_II
   $IPT -t nat -D PREROUTING -p udp -d $EXT_IP --dport $PORT_II -j DNAT --to-destination $HOST:$PORT_II
   $IPT -t nat -D POSTROUTING -p udp -s $HOST --sport $PORT_II -j SNAT --to-source $EXT_IP:$PORT_II
   PORT_II=$[PORT_I + 1]
   done</pre>
  <pre>$IPT -L -v -t nat |grep &quot;udp spt:16&quot;
$IPT -L -v -t nat |grep &quot;udp dpt:16&quot;</pre>
  <pre>echo &quot;Battle - STOP - OK&quot;
;;
*)
     usage
;;
esac</pre>
  <p>Running this script produces the following output:</p>
  <pre>. ./startcraft_iptables.sh stop
script underway...
received START
 0 0 SNAT udp -- any any 192.168.10.185 anywhere udp spt:16185 to:245.012.10.1:16185 
 0 0 SNAT udp -- any any 192.168.10.186 anywhere udp spt:16186 to:245.012.10.1:16186 
 0 0 SNAT udp -- any any 192.168.10.187 anywhere udp spt:16187 to:245.012.10.1:16187 
 0 0 SNAT udp -- any any 192.168.10.188 anywhere udp spt:16188 to:245.012.10.1:16188 
 0 0 SNAT udp -- any any 192.168.10.189 anywhere udp spt:16189 to:245.012.10.1:16189 
 0 0 SNAT udp -- any any 192.168.10.190 anywhere udp spt:16190 to:245.012.10.1:16190 
 0 0 SNAT udp -- any any 192.168.10.191 anywhere udp spt:16191 to:245.012.10.1:16191 
 0 0 SNAT udp -- any any 192.168.10.192 anywhere udp spt:16192 to:245.012.10.1:16192 
 0 0 SNAT udp -- any any 192.168.10.193 anywhere udp spt:16193 to:245.012.10.1:16193 
 0 0 SNAT udp -- any any 192.168.10.194 anywhere udp spt:16194 to:245.012.10.1:16194 
 0 0 SNAT udp -- any any 192.168.10.195 anywhere udp spt:16195 to:245.012.10.1:16195 
 0 0 SNAT udp -- any any lisa anywhere udp spt:16196 to:245.012.10.1:16196 
 0 0 SNAT udp -- any any grant anywhere udp spt:16197 to:245.012.10.1:16197 
 0 0 SNAT udp -- any any 192.168.10.98 anywhere udp spt:16198 to:245.012.10.1:16198 
 0 0 SNAT udp -- any any 192.168.10.199 anywhere udp spt:16199 to:245.012.10.1:16199 
 0 0 SNAT udp -- any any david anywhere udp spt:16200 to:245.012.10.1:16200 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16185 to:192.168.10.185:16185 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16186 to:192.168.10.186:16186 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16187 to:192.168.10.187:16187 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16188 to:192.168.10.188:16188 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16189 to:192.168.10.189:16189 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16190 to:192.168.10.190:16190 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16191 to:192.168.10.191:16191 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16192 to:192.168.10.192:16192 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16193 to:192.168.10.193:16193 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16194 to:192.168.10.194:16194 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16195 to:192.168.10.195:16195 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16196 to:192.168.10.196:16196 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16197 to:192.168.10.197:16197 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16198 to:192.168.10.98:16198 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16199 to:192.168.10.199:16199 
 0 0 DNAT udp -- any any anywhere 245-012-10-1.cable.hawaii.net.usudp dpt:16200 to:192.168.10.200:16200 
 Battle - START - OK </pre>
  <p>Similarily the reverse:</p>
  <pre>. ./startcraft_iptables.sh stop 
script underway...
Battle - STOP - OK </pre>
  <p>&nbsp;</p>
  <p>The address_translation.conf entries are thus:</p>
  <pre>192.168.10.200:16200 245.012.10.1:16200 192.168.10.0/24,10.1.1.0/24 ANY
192.168.10.199:16199 245.012.10.1:16199 192.168.10.0/24 ANY
192.168.10.197:16197 245.012.10.1:16197 192.168.10.0/24 ANY
192.168.10.196:16196 245.012.10.1:16196 192.168.10.0/24 ANY
192.168.10.195:16195 245.012.10.1:16195 192.168.10.0/24 ANY
192.168.10.194:16194 245.012.10.1:16194 192.168.10.0/24 ANY
192.168.10.193:16193 245.012.10.1:16193 192.168.10.0/24 ANY
192.168.10.192:16192 245.012.10.1:16192 192.168.10.0/24 ANY
192.168.10.191:16191 245.012.10.1:16191 192.168.10.0/24 ANY
192.168.10.190:16190 245.012.10.1:16190 192.168.10.0/24 ANY
192.168.10.189:16189 245.012.10.1:16189 192.168.10.0/24 ANY
192.168.10.188:16188 245.012.10.1:16188 192.168.10.0/24 ANY
192.168.10.187:16187 245.012.10.1:16187 192.168.10.0/24 ANY
192.168.10.186:16186 245.012.10.1:16186 192.168.10.0/24 ANY
192.168.10.185:16185 245.012.10.1:16185 192.168.10.0/24 ANY
192.168.10.184:16184 245.012.10.1:16184 192.168.10.0/24 ANY </pre>
  <p>&nbsp;</p>
  <p>Setting the Windows Registry for the port number can be done with the following</p>
  <pre>Windows Registry Editor Version 5.00
 
 [HKEY_LOCAL_MACHINE\SOFTWARE\Battle.net]
 
 [HKEY_LOCAL_MACHINE\SOFTWARE\Battle.net\Configuration]
 "Game Data Port"=dword:000017e8 </pre>
  <p>Where &quot;dword:000017e8&quot; is the port number in hex. Mac users can use the MacBNetGatewayEdttor version 0.4.2 or higher and make this change through the graphical user interface. </p>
  <p>&nbsp; </p>
  <p>background details on this is available at <a href="http://forums.pvpgn.org/index.php?showtopic=2899&st=0&p=10798&#entry10798">http://forums.pvpgn.org/index.php?showtopic=2899&st=0&p=10798&#entry10798</a></p>
  <p>&nbsp; 
  </p>
</blockquote>
<p><strong>Configuring PvPGN for WarCraft III<a name="w3route"></a></strong></p>
<blockquote>
  <p class="style1">This documentation supports version 1.7.0 of the PvPGN software and higher. </p>
  <p>All WarCraft III play happens  peer-to-peer so the game clients need to directly connect to each other.<BR>
External clients connect to your server reporting their external IP and your local clients get told by the server to connect to these external IP addresses.</p>
  <p>    You local clients connect to your server via the local IP address and this local IP address is reported to the external clients to connect to. Too bad they presume this local IP address is  in <B>their</B> local network, not the servers local network. This means that the external clients could never find the server again.</p>
  <p>This challenge is addressed as follows:</p>
</blockquote>
<ol>
  <li>On all your local PCs that want to play WAR3 (including the server PC if you want to play WAR3 on that one) start up WAR3 and enter the Options menu and the suboption gameplay. Now change the port to be used to a so far unused port (one unique port for each PC in your LAN)</li>
  <li>Configure port forewarding on your server PC so each port you just had chosen on your LAN PCs WAR3 installation gets forewarded to the respective PC (obvisiously not needed for the WAR3 client on the server PC)</li>
  <li>Modify address_translation.conf so your LAN IPs appear as external IPs for all clients not within you LAN </li>
  <li>Finally modify bnetd.conf and configure w3route parameter.</li>
</ol>
<blockquote>
  <p>&nbsp;</p>
  <p><strong>Detailed scenario</strong></p>
  <p>Let's presume you have two WAR3 clients on your LAN, one at 192.168.0.10 (later on called LAN-IP-A) and the other at 192.168.0.11 (later on called LAN-IP-B)
    <!--emo&B)-->
    <!--endemo-->
    <BR>
    <BR>
  Now on the WAR3 client at LAN-IP-A you chose gameport 16801, for the WAR3 client at LAN-IP-B you choose gameport 16802.</p>
  <p>    Next thing for you to do is change some setting within the properties of your internet connection sharing. Choose the settings button and add two new "services". Call the first one "WAR3 at LAN-IP-A", set the IP address to LAN-IP-A and as external and internal port choose 16801. (According to my sample for LAN-IP-A also add a rule for LAN-IP-B and port 16802).<BR>
    <BR>
    So far, with all those settings made you should be able to play fine on battle.net with your LAN clients, even if battle.net falls back into peer-to-peer mode (which can rarely happen)<BR>
    <BR>
    Now add a few lines to your address_translation.conf. You should basically need two blocks of translational rules. One for the <SPAN 
class=searchlite>w3route</SPAN> and one for your LAN clients.<BR>
  </p>
  <p class="style4">[Editors Note begins : While creating this documentation I became slightly confused between the contents of the address_translation.conf file and the remainder of the documentation. I think that the documentation is good but that the comments at the beginning of the w3route section could be slightly miss leading or confusing. Going by the documentation the first 2 lines in this w3route section shoudl be uncommented and configured.] </p>
  <p class="style3">address_translation.conf<br>
    ########################################################################################################<br>
    # w3route server ip (removed from w3trans.conf) (Port 6200) #<br>
    # #<br>
    # Set input address the same as the w3routeaddr setting in the bnetd.conf #<br>
    # Set output address to the address to be sent to war3 clients #<br>
    # Set exclude to the range of clients you want to recieve the input address #<br>
    # instead of the output address #<br>
    # Set include to the range of clients you want to recieve the output address #<br>
    # #<br>
    # input (ip:port) output (ip:port) exclude (ip/netmask) include (ip/netmask) #<br>
  #--------------------- ---------------------- ---------------------------- -------------------------</p>
  <p class="style3">#0.0.0.0:6200 192.168.1.100:6200 NONE 192.168.1.0/24<br>
    #0.0.0.0:6200 internetip:6200 NONE ANY</p>
  <p><span class="style4">[Editors Note begins : ends ]</span></p>
  <p><BR>
    The first ruleset is ment to let your LAN clients connect to <SPAN 
class=searchlite>w3route</SPAN> via LAN but the external clients to connect via external IP:<BR>
    <!--c1-->
  </p>
  <DIV class=codetop>
    <pre>0.0.0.0:6200 &nbsp;192.168.0.1:6200 NONE &nbsp; &nbsp;192.168.0.0/24
0.0.0.0:6200 &nbsp;internetip:6200 &nbsp;NONE &nbsp; &nbsp;ANY
</pre>
  </DIV>
  (substitute internetip with your internet IP)<BR>
  <BR>
The other ruleset we'll add is neeed to make external clients connect to your local clients via your external IP address and the forewarding rules we added earlier<BR>
<!--c1-->
<DIV class=codetop>  
    <pre>LAN-IP-A:16801 internetip:16801 &nbsp;192.168.1.0/24 &nbsp; ANY
LAN-IP-B:16802 internetip:16802 &nbsp;192.168.1.0/24 &nbsp; ANY
</pre>
</DIV>
(substitute LAN-IP-A, LAN-IP-B and internet IP with the correct IPs)<BR>
<BR>
So in case you wonder what those rules mean, I'll try to give a quick explaination:<BR>
LAN-IP-A:16801 internetip:16801 192.168.1.0/24 ANY<BR>
translates to something like:<BR>
If <B>ANY</B>one asks for LAN-IP-A:16801 <B>translate it</B> to internetip:16801 <B>unless</B> the requestor is located within 192.xxx.xxx.xxx (which will then receive untranslated IP)
<p>&nbsp;</p>
<p>Changes to the bnetd.conf file are as follows: </p>
<pre># W3 Play Game router address. Just put your server address in here
# or use 0.0.0.0:6200 for server to bind to all interfaces,
# but make sure you set up w3trans if you do.
#w3routeaddr = &quot;internetip:6200&quot;
w3routeaddr = &quot;0.0.0.0:6200&quot;</pre>
<p>Where an internetip address of 0.0.0.0 means that w3routeaddr is not configured. Replace 0.0.0.0. with your external ip address and restart the PvPGN server software. </p>
<p><strong>Tips</strong></p>
<table width="661" border="0">
  <tr>
    <td width="129" valign="top"><span class="style6">User Comment </span></td>
    <td width="522">There are lots of uses of 0.0.0.0 in the configuration but my server never worked right until I used an actual IP instead of 0.0.0.0. And at times I could get some clients to connect </td>
  </tr>
  <tr>
    <td valign="top"><span class="style6">Developer Comment </span></td>
    <td><p>For some time now (most likely since version 1.7.0) address 0.0.0.0 for w3route is converted by the server before being sent to the client - the local end point of that client bnet connection.</p>
      <p>This means that in the usual case it works. </p>
      <p>Where it does not work is for example when the sevver is inside the LAN and the client is external. In that case it will send the LAN IP address because that is what it sees as the local endpoint of the bnet connection of that client. </p></td>
  </tr>
</table>
<p>&nbsp;</p>
</blockquote>
<p><strong>          Setting up a Diablo II closed realm from behind a router<a name="diablorouter"></a></strong></p>
<blockquote>
    <p>&lt;<em>Editors note: Documentation required</em>&gt;</p>
    <p>&nbsp;</p>
</blockquote>
<p><strong>Diagnosing Router/Firewall issues<a name="firewallissues"></a></strong></p>
<blockquote>
    <p>This help text has come c/- <a href="http://pvpgn.ez15loan.com/originals/The-Warcraft-III-Pub.htm">http://pvpgn.ez15loan.com/originals/The-Warcraft-III-Pub.htm</a><br>
    It may assist you in diagnosing some configuration issues.<br>
    <br>
    Battle.net (TM) Router/Firewall Configuration<br>
    By: Draino<br>
  Aim: CyrusL</p>
    <p> The reason people are having problems is because of 
  either a firewall, or a non-forwarded port on their routers.</p>
    <p> A. Its the router!<br>
    When you have a router you essentially have multiple computers connected to the
    internet off one IP address. Now each computer has an individual LAN IP and the 
    shared internet (or WAN) IP. When another comptuer wants to send a packet to your 
    computer it goes to the router, who has to route it (pun intended), to your specific 
    computer. Lets say your LAN IP is 1.2.3.4 and your internet IP is 12.34.45.78. 
    Blizzard wants to send you a packet, but it doesnt know/care about your LAN IP. 
    It sends that packet to 12.34.45.78 because as far as it knows, that is your 
    computer. Your router gets this packet, but doesnt know it's supposed to go to you, 
  so it ends up getting lost and not sent to 1.2.3.4.</p>
    <p> B. Its the firewall!<br>
    This is far more simple. A firewall is almost always used for security reasons, 
    by blocking ports or blocking all ports and only leaving a few open. This prevents 
    hackers from getting in by not allowing them an entry point. For example, I may 
    run a firewall that blocks everything but my ports used for browsing the net, 
    using kazaa, and going on AIM. This means my war3 port is closed, 
  so packets cannot be sucessfully sent to blizzard, and received.</p>
    <p> So how do we fix this mess up in here?</p>
    <p> A. Router Fix<br>
    What you need to do is forward port 6112 to your internal LAN IP from the router, 
    so the router knows where to send it. You will do this by accessing your router, 
  and changing its settings.</p>
    <p> 1. Connect to the box<br>
    All routers these days have access through an html page. You just need to know your 
    routers IP. There's a couple ways to do this. Check your manual, guess, or check 
    your gateway. Option 1 is self-explanatory. Option 2 is a little complicated. A 
    couple common ones are 192.168.2.1 , 192.168.1.1 , and 192.168.0.1. Odds are it 
    is your IP with a .1 as the last subnet. Option C is to go to your IP properties, 
    and find the default gateway. For NT based opperating systems (XP and Win 2000) 
    go start -&gt; run -&gt; command. Type in ipconfig and hit enter. Default gateway will <br>
    be there. For 9x opperating systems, go start -&gt; run -&gt; winipcfg and hit enter. 
    To connect to your router go to http://&lt;routerip&gt;. For example, I connect to my 
  router by going to http://192.168.2.1 in internet explorer.</p>
    <p> 2. Going to port forwarding options<br>
    Once you are at your router screen, logon. Odds are if you didnt know how to do 
    step 1 your password is either nothing, or your router companie's name. Now this 
    is where it gets a little tricky because each router differs. You need to find the 
  section of your router with settings for something like &quot;Virtual Server&quot; or&quot;Port forwarding.&quot; This will enable you to forward port 6112. </p>
    <p> B. Firewall Fix<br>
    You have two options. Either unblock port 6112, or turn off your firewall. 
    This is much easier. For those of you who actually know you have a firewall 
    running, you should know how to open 6112. Most of the people that are looking 
    at this probably have XP and haven't turned off the default firewall thats 
    crapping you out. To disable this right click on network connections 
    (on the desktop), and select properties. Then right click on Local Area Network 
  and select properties again. Go to the advanced tab, and uncheck firewall.</p>
    <p> So in conclusion, if you are still having problems after this, it probably 
    isnt a network related thing, but still ask for help in the comments. In the 
    remote case that you changed your warcraft 3 port in the registry away from 
    6112, just change the port forwarding to that port.<br>
  </p>
</blockquote>
<p><strong>Legal</strong></p>
<blockquote>
    <p>Battle.net and Blizzard Entertainment are trademarks or registered trademarks of Blizzard Entertainment in the U.S. and/or other countries. Usage of the PvPGN software is free under the GNU public license. While every attempt has been made to ensure that the software functions as intended and that the documentation provided is accurate, the PvPGN community of developers and contributors cannot be held responsible for any issues arrising from having or running the software. </p>
    <p>&nbsp;    </p>
</blockquote>
<blockquote>
  <p>&nbsp;</p>
</blockquote>
<blockquote>&nbsp;</blockquote>